<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="FXDiagram : A framework for diagrams using JavaFX">
	<meta name="author" content="Jan Koehnlein">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/prettify.css"  />
    <title>FXDiagram - Tutorial</title>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60151969-1', 'auto');
  ga('send', 'pageview');
	</script>
</head>

  <body>
  
     <div id="header_wrap" class="outer">
    <header class="inner">
    <a id="forkme_banner" href="https://github.com/JanKoehnlein/FXDiagram">View on GitHub</a>

	  <h1 id="project_title">FXDiagram</h1>
	  <h2 id="project_tagline">A framework for diagrams using JavaFX</h2>

		<section id="downloads">
		  <a class="zip_download_link" href="https://github.com/JanKoehnlein/FXDiagram/zipball/master">Download this project as a .zip file</a>
		  <a class="tar_download_link" href="https://github.com/JanKoehnlein/FXDiagram/tarball/master">Download this project as a tar.gz file</a>
		</section>
	</header>
</div>

	<div id="main_content_wrap" class="outer">
		<div id="toc" class="toc">
			<ul id="nav-outline" class="toc">
	<li><a href="../index.html">Home</a></li>
	<li><a href="introduction.html">Introduction</a></li>
	<li><a href="get-started.html">Get Started</a></li>
	<li><a href="ide-setup.html">IDE Setup</a></li>	
	<li><a href="tutorial-hla.html">Tutorial</a></li>	
	<li><a href="concepts.html">Concepts</a></li>	
	<li><a href="resources.html">Resources</a></li>	
</ul>
		</div>
		<div id="main_content" class="inner">
			<h1 id="diagram-config">Tutorial</h1>

<p>This section guides you to create a FXDiagram view for your own models using the high-level mapping API. Both, the Eclipse integration and the IDEA integration, offer an extension point to register your mapping configuration and pick it up automatically. That is, in most cases all you have to do to get a working diagram tool is to write a mapping config.</p>

<h3 id="diagram-configuration">Diagram Configuration</h3>

<p>A diagram configuration serves three purposes:</p>

<ol>
  <li>Define how domain objects are mapped to nodes, edges and diagrams.</li>
  <li>Define on which domain objects a <em>Show in FXDiagram</em> action is available.</li>
  <li>Define how the domain objects can be accessed and serialized.</li>
</ol>

<p>It is specified in a class extending the <code>XDiagramConfig</code> interface. Diagram configs can be most conveniently implemented in Xtend, but Java is of course possible as well. This is how a statemachine diagram configuration could look like</p>

<pre><code class="language-xtend">class StatemachineDiagramConfig extends AbstractDiagramConfig {
  // fields to define mappings (1)
  val stateNode = new NodeMapping&lt;State&gt;...  
  val transitionConnection = new ConnectionMapping&lt;Transition&gt;...
  
  // method to define entry points (2)
  override protected &lt;ARG&gt; entryCalls...
  
  // method defining the domain object access (3)
  override protected createDomainObjectProvider...
}
</code></pre>

<p>For your convenience, there are a bunch of abstract superclasses you can extend for certain use cases, such as Xtext-based models, Eclipse-based models, and IDEAâ€™s PSI models.</p>

<h4 id="mappings">Mappings</h4>

<p>A mapping describes how a domain object is mapped to a diagram element. There are three types of mappings: node mapping, connection mapping and diagram mapping. A mapping is  implemented as a field of the respective class in the diagram configuration class.</p>

<pre><code class="language-xtend">val stateNode = new NodeMapping&lt;State&gt;(this, 'stateNode', 'State') 
</code></pre>

<p>The type parameter describes the type of the domain object. The constructor arguments are the configuration this mapping belongs to, an identifier and a human readable name for the mapping.</p>

<p>All mappings have a <code>calls()</code> method that describes what else to create when this mapping is executed. This is usually done by calling another mapping in a certain role for a given single/collection of related domain object/s. e.g.</p>

<pre><code class="language-xtend">val stateNode = new NodeMapping&lt;State&gt;(...) {
  override calls() {
    transitionConnection.outConnectionForEach[transitions]
  }
</code></pre>

<p>In this case the connection mapping <code>transitionConnection</code> is executed for all <code>transitions</code> to create a an outgoing connection from the current node. Note that the <code>transitions</code> is inside a lambda expression that is executed with the domain object of the current node, so <code>[transitions]</code> is in fact a very sugared Xtend version of <code>State s -&gt; s.getTransitions()</code> in Java 8 syntax.</p>

<p>By using <code>outConnectionForEach</code> the transition that is created will already have its <code>source</code> set. Do not forget to set the <code>target</code>:</p>

<pre><code class="language-xtend">val transitionConnection = new ConnectionMapping&lt;Transition&gt;(...) {
  ...
  override protected calls() {
    stateNode.target[state] // Transition t -&gt; t.getState()
  }
}
</code></pre>

<p>Some mapping calls can be further customized, e.g. <code>ConnectionMappingCall#asButton</code> to add a popup button that allows the user to decide whether this mapping should be executed, or <code>DiagramMappingCall#onOpen</code> for drill-down diagrams. See the example mappings for further details.</p>

<p>When you want to use your own implementation of a node, connection or diagram, you can override the respective <code>createXXX</code> method. E.g.</p>

<pre><code class="language-xtend">val transitionConnection = new ConnectionMapping&lt;Transition&gt;(...) {
  override createConnection(
        IMappedElementDescriptor&lt;Transition&gt; descriptor) {
    // create a connection with a label for the event name
    super.createConnection(descriptor) =&gt; [
      new XConnectionLabel(it) =&gt; [ label |
        label.text.text = descriptor.withDomainObject[event.name]
      ]    
    ]
  }
  ...
}
</code></pre>

<p>This allows you to add all kind of fancy JavaFX behavior in your nodes and connections. See e.g. the <code>JvmTypeNode</code> for some freaky inflate, flip and customization effects.</p>

<h4 id="entry-point">Entry Point</h4>

<p>The IDE has to know on what kind of elements the user could execute mappings. This is what the <code>entryCalls()</code> method is about. It usually boils down to implement a switch with type guards, i.e.</p>

<pre><code class="language-xtend">override protected &lt;ARG&gt; entryCalls(
      ARG element, 
      extension MappingAcceptor&lt;ARG&gt; acceptor) {
  switch element {
    State: {
      add(stateNode, [element])
      add(statemachineDiagram, 
        [element.eContainerOfType(Statemachine)])
    }	
  }
}
</code></pre>

<p>Note that once again, a lambda expression allows you to execute a completely different mapping for some other model element.</p>

<h4 id="registration">Registration</h4>

<p>Eventually, the runtime infrastructure of your IDE has to pick your configuration mapping up somehow. In Eclipse, diagram configurations are registered to the extension point <code>de.fxdiagram.mapping.fxDiagramConfig</code>, e.g.</p>

<pre><code class="language-xml">&lt;extension point="de.fxdiagram.mapping.fxDiagramConfig"&gt;
  &lt;config
    id="de.fxdiagram.xtext.fowlerdsl.StatemachineDiagramConfig"
    label="Statemachine"
    class="...StatemachineDiagramConfig"&gt;
  &lt;/config&gt;
&lt;/extension&gt;
</code></pre>

<p>in the <em>plugin.xml</em> or <em>fragment.xml</em>. Note that for Xtext-based models you have to use the extension factory of your language, e.g.</p>

<pre><code class="language-xml">class="....MyDslExecutableExtensionFactory:....MyDslDiagramConfig"
</code></pre>

<p>to get all required dependencies injected.</p>

<p>In IDEA, put</p>

<pre><code class="language-xml">&lt;extensions defaultExtensionNs="de.fxdiagram.idea"&gt;
  &lt;fxDiagramConfig implementation="...MyDiagramConfig"/&gt;
&lt;/extensions&gt;
</code></pre>
<p>in your <em>plugin.xml</em>.</p>

<p>For standalone Java applications, there is <code>XDiagramConfig.Registry.instance#addConfig()</code> but there is no additional tooling picking that up.</p>

		</div>
	</div>
    <!-- FOOTER  -->
<div id="footer_wrap" class="outer">
	<footer class="inner">
		<p class="copyright">FXDiagram is maintained by <a href="https://github.com/JanKoehnlein">JanKoehnlein</a></p>
		<p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
		<script src="javascripts/jquery-1.7.1.min.js" type="text/javascript"></script>
		<script src="javascripts/prettify.js" type="text/javascript"></script>
		<script src="javascripts/lang-xtend.js" type="text/javascript"></script>
		<script src="javascripts/lang-common.js" type="text/javascript"></script>
		<script src="javascripts/custom.js" type="text/javascript"></script>
	</footer>
</div>


  </body>

</html>
